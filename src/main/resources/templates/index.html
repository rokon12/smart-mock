<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Mock - AI-Powered API Mock Server</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- Hero Section -->
    <section class="hero-gradient text-white py-5">
        <div class="container text-center">
            <h1 class="display-3 fw-bold mb-3">
                <i class="bi bi-robot"></i> Smart Mock Server
            </h1>
            <p class="lead fs-4 mb-4">AI-Powered API Mocking with OpenAPI</p>
            
            <div th:if="${activeSchema != null}" class="alert alert-success d-inline-block">
                <i class="bi bi-check-circle-fill"></i>
                Active Schema: <strong th:text="${activeSchema.name}">API</strong>
                <span class="badge bg-light text-dark ms-2" th:text="${schemas.size() + ' schema(s) loaded'}">0 schemas</span>
            </div>
            <div th:unless="${activeSchema != null}" class="alert alert-warning d-inline-block">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span th:if="${!schemas.isEmpty()}" th:text="${schemas.size() + ' schema(s) loaded but none active'}">No active schema</span>
                <span th:if="${schemas.isEmpty()}">No schemas loaded yet</span>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container py-5">
        <!-- Schema Management Section -->
        <div th:if="${!schemas.isEmpty()}" class="card mb-4 border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-layers"></i> Loaded Schemas</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Version</th>
                                <th>Endpoints</th>
                                <th>Uploaded</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="schema : ${schemas}" th:classappend="${schema.id == activeSchema?.id} ? 'table-success' : ''">
                                <td>
                                    <strong th:text="${schema.name}">Schema Name</strong>
                                    <span th:if="${schema.id == activeSchema?.id}" class="badge bg-success ms-2">Active</span>
                                </td>
                                <td th:text="${schema.version}">1.0.0</td>
                                <td><span class="badge bg-info" th:text="${schema.endpointCount}">0</span></td>
                                <td th:text="${#temporals.format(schema.uploadedAt, 'MMM dd, HH:mm')}">Jan 01, 12:00</td>
                                <td>
                                    <button th:unless="${schema.id == activeSchema?.id}" 
                                            class="btn btn-sm btn-success btn-activate-schema" 
                                            th:data-schema-id="${schema.id}">
                                        <i class="bi bi-check-circle"></i> Activate
                                    </button>
                                    <button class="btn btn-sm btn-primary btn-explore-schema" 
                                            th:data-schema-id="${schema.id}">
                                        <i class="bi bi-box-arrow-up-right"></i> Explore
                                    </button>
                                    <button class="btn btn-sm btn-danger btn-delete-schema" 
                                            th:data-schema-id="${schema.id}">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <button class="btn btn-secondary" onclick="loadSampleSchemas()">
                        <i class="bi bi-collection"></i> Load All Sample Schemas
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Upload Section -->
        <div class="card mb-5 border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-upload"></i> Upload New OpenAPI Specification</h5>
            </div>
            <div class="card-body">
                <form id="uploadForm">
                    <div class="mb-3">
                        <label for="specFile" class="form-label">Select OpenAPI Specification File (YAML or JSON)</label>
                        <input class="form-control" type="file" id="specFile" accept=".yaml,.yml,.json" required>
                        <div class="form-text">Supported formats: OpenAPI 3.0+ (YAML or JSON)</div>
                    </div>
                    <div class="mb-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-cloud-upload"></i> Upload Specification
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="loadSampleSpec()">
                            <i class="bi bi-file-earmark-text"></i> Load Samples
                        </button>
                    </div>
                </form>
                <div id="uploadAlert" class="alert d-none" role="alert"></div>
            </div>
        </div>

        <!-- Active Schema Details -->
        <div th:if="${activeSchema != null}" class="card mb-5 border-success">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-file-code"></i> Active Schema Details</h5>
                <button class="btn btn-sm btn-light" onclick="clearSpec()">
                    <i class="bi bi-x-circle"></i> Clear All
                </button>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Title:</strong> <span th:text="${specTitle}">API Title</span></p>
                        <p th:if="${specVersion}"><strong>Version:</strong> 
                            <span class="badge bg-primary" th:text="${specVersion}">1.0.0</span>
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p th:if="${specDescription}"><strong>Description:</strong> 
                            <span th:text="${specDescription}">API Description</span>
                        </p>
                        <p><strong>Endpoints:</strong> 
                            <span class="badge bg-info text-dark" th:text="${endpointCount + ' endpoints available'}">0 endpoints</span>
                        </p>
                    </div>
                </div>
                <div class="mt-3">
                    <a href="/swagger-ui.html" class="btn btn-primary" target="_blank" 
                       data-bs-toggle="tooltip" data-bs-placement="top" 
                       title="Open interactive API explorer to test mock endpoints">
                        <i class="bi bi-box-arrow-up-right"></i> Explore & Test API
                    </a>
                    <button class="btn btn-sm btn-outline-primary" onclick="viewSpec()">
                        <i class="bi bi-eye"></i> View Full Spec
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="downloadSpec()">
                        <i class="bi bi-download"></i> Download Spec
                    </button>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <section class="mb-5">
            <h2 class="display-6 mb-4"><i class="bi bi-stars"></i> Features</h2>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 feature-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-cpu feature-icon text-primary"></i>
                                LLM-Powered Responses
                            </h5>
                            <p class="card-text">Generates intelligent, context-aware mock data using Ollama with local language models</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 feature-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-file-earmark-code feature-icon text-success"></i>
                                OpenAPI Integration
                            </h5>
                            <p class="card-text">Automatically creates endpoints from your OpenAPI/Swagger specifications</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 feature-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-mask feature-icon text-warning"></i>
                                Scenario Testing
                            </h5>
                            <p class="card-text">Switch between happy path, edge cases, errors, and rate limiting scenarios</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 feature-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-dice-5 feature-icon text-info"></i>
                                Deterministic Mode
                            </h5>
                            <p class="card-text">Use seeds for reproducible responses in testing pipelines</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 feature-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-lightning-charge feature-icon text-danger"></i>
                                Performance Caching
                            </h5>
                            <p class="card-text">Intelligent response caching with Caffeine for sub-millisecond responses</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 feature-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-clock-history feature-icon text-secondary"></i>
                                Latency Simulation
                            </h5>
                            <p class="card-text">Simulate real-world network conditions with configurable delays</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 feature-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-compass feature-icon text-purple"></i>
                                Interactive API Explorer
                            </h5>
                            <p class="card-text">Browse and execute API calls directly from Swagger UI with live mock responses</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Control Headers -->
        <section class="mb-5">
            <h2 class="display-6 mb-4"><i class="bi bi-sliders"></i> Control Headers</h2>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Header</th>
                            <th>Description</th>
                            <th>Example Values</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>X-Mock-Scenario</code></td>
                            <td>Choose response scenario</td>
                            <td>
                                <span class="badge bg-success me-1">happy</span>
                                <span class="badge bg-warning me-1">edge</span>
                                <span class="badge bg-danger me-1">invalid</span>
                                <span class="badge bg-info me-1">rate-limit</span>
                                <span class="badge bg-dark">server-error</span>
                            </td>
                        </tr>
                        <tr>
                            <td><code>X-Mock-Seed</code></td>
                            <td>Deterministic response generation</td>
                            <td><code>test-seed-123</code></td>
                        </tr>
                        <tr>
                            <td><code>X-Mock-Temperature</code></td>
                            <td>Control response variation (0-1)</td>
                            <td><code>0.5</code></td>
                        </tr>
                        <tr>
                            <td><code>X-Mock-Latency</code></td>
                            <td>Simulate network delay</td>
                            <td><code>250ms</code>, <code>1.5s</code></td>
                        </tr>
                        <tr>
                            <td><code>X-Mock-Status</code></td>
                            <td>Override response status code</td>
                            <td><code>201</code>, <code>404</code>, <code>500</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Quick Start -->
        <section class="mb-5">
            <h2 class="display-6 mb-4"><i class="bi bi-rocket-takeoff"></i> Quick Start</h2>
            <div class="card bg-dark text-white">
                <div class="card-body position-relative">
                    <button class="btn btn-sm btn-outline-light copy-btn position-absolute top-0 end-0 m-3" 
                            onclick="copyCode('quickstart-code')">
                        <i class="bi bi-clipboard"></i> Copy
                    </button>
                    <pre class="mb-0"><code class="language-bash" id="quickstart-code"># 1. Upload your OpenAPI spec
curl -X POST http://localhost:8080/api/schemas?name=MyAPI \
  -H "Content-Type: application/yaml" \
  --data-binary @your-api-spec.yaml

# 2. Test mock endpoints
curl http://localhost:8080/mock/your-endpoint

# 3. Try different scenarios
curl -H "X-Mock-Scenario: server-error" \
     http://localhost:8080/mock/your-endpoint</code></pre>
                </div>
            </div>
        </section>

        <!-- API Endpoints -->
        <section class="mb-5">
            <h2 class="display-6 mb-4"><i class="bi bi-gear"></i> API Endpoints</h2>
            <div class="list-group">
                <div class="list-group-item">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-primary me-3">GET</span>
                        <div>
                            <code class="fs-6">/api/schemas</code>
                            <p class="mb-0 text-muted small">List all uploaded schemas</p>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-success me-3">POST</span>
                        <div>
                            <code class="fs-6">/api/schemas?name={name}</code>
                            <p class="mb-0 text-muted small">Upload a new OpenAPI specification</p>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-success me-3">POST</span>
                        <div>
                            <code class="fs-6">/api/schemas/{id}/activate</code>
                            <p class="mb-0 text-muted small">Activate a specific schema</p>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-danger me-3">DELETE</span>
                        <div>
                            <code class="fs-6">/api/schemas/{id}</code>
                            <p class="mb-0 text-muted small">Delete a schema</p>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-success me-3">POST</span>
                        <div>
                            <code class="fs-6">/api/schemas/load-samples</code>
                            <p class="mb-0 text-muted small">Load sample Pet Store schemas</p>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-info me-3">GET</span>
                        <div>
                            <code class="fs-6">/swagger-ui.html</code>
                            <p class="mb-0 text-muted small">Interactive API Explorer (Swagger UI)</p>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-primary me-3">GET</span>
                        <div>
                            <code class="fs-6">/api-spec?schemaId={id}</code>
                            <p class="mb-0 text-muted small">Get OpenAPI spec in JSON format (optional schemaId parameter)</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Technology Stack -->
        <section class="mb-5">
            <h2 class="display-6 mb-4"><i class="bi bi-stack"></i> Technology Stack</h2>
            <div class="row g-3">
                <div class="col-md-6 col-lg-4" th:each="tech : ${techStack}">
                    <div class="tech-item p-3 rounded bg-light">
                        <h6 class="fw-bold" th:text="${tech.key}">Technology</h6>
                        <small class="text-muted" th:text="${tech.value}">Description</small>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">Smart Mock Server - AI-Powered API Mocking</p>
            <small class="text-muted">
                Version <span th:text="${projectVersion}">1.0</span> | 
                Built with Spring Boot & LangChain4j
            </small>
        </div>
    </footer>

    <!-- Spec Viewer Modal -->
    <div class="modal fade" id="specModal" tabindex="-1" aria-labelledby="specModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="specModalLabel">
                        <i class="bi bi-file-code"></i> OpenAPI Specification
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <pre class="language-yaml" style="max-height: 70vh; overflow-y: auto;"><code id="specContent">Loading...</code></pre>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="copySpec()">
                        <i class="bi bi-clipboard"></i> Copy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script th:src="@{/js/app.js}"></script>
</body>
</html>